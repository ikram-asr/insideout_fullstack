
  <body class="w-screen bg-gray-300">
    <div class="w-full h-screen flex">
      <nav
        class="min-[501px]:hidden w-full bg-white h-16 rounded-t-[50%] fixed bottom-0"
      >
        <div class="absolute mobile-nav-4">
          <a *ngIf="user.id" [routerLink]="['/dashboard/', user.id]"
            ><img class="absolute-center" src="/assets/icons/icons/home.svg" alt=""
          /></a>
        </div>
        <div class="absolute mobile-nav-1">
          <a *ngIf="user.id" [routerLink]="['/messages/', user.id]"
            ><img
              class="absolute-center"
              src="/assets/icons/icons/msg.png"
              alt=""
          /></a>
        </div>
        <div class="absolute mobile-nav-2">
          <a *ngIf="user.id" [routerLink]="['/programs/', user.id]"
            ><img
              class="absolute-center"
              src="/assets/icons/icons/programs.svg"
              alt=""
          /></a>
        </div>
        <div class="absolute mobile-nav-3">
          <a *ngIf="user.id" [routerLink]="['/community/', user.id]"
            ><img
              class="absolute-center"
              src="/assets/icons/icons/community.svg"
              alt=""
          /></a>
        </div>
        <div class="absolute mobile-nav-active">
          <a *ngIf="user.id" [routerLink]="['/settings/', user.id]"
            ><img
              class="absolute-center"
              src="/assets/icons/icons/settings-mobile-active.svg"
              alt=""
          /></a>
        </div>
      </nav>
      <!-- tablet-nav -->
      <nav
      class="max-[501px]:hidden min-[1024px]:hidden h-[64px] py-[8px] z-10 border-t-2 border-[silver] bg-white fixed bottom-0 w-full flex items-center justify-evenly"
    >
      <a class="tablet-nav-item" *ngIf="user.id" [routerLink]="['/dashboard/', user.id]"
        ><img
          class="w-7"
          src="/assets/icons/icons/dashboard.svg"
          alt=""
        /><span class="text-xs"
          >Dashboard</span
        ></a
      >
      <a class="tablet-nav-item" *ngIf="user.id" [routerLink]="['/programsuggestion/', user.id]"
      ><img
        class="w-7"
        src="/assets/icons/icons/programs.svg"
        alt=""
      /><span class="text-xs">Articles</span></a
    >
      <a class="tablet-nav-item" *ngIf="user.id" [routerLink]="['/Programs/', user.id]"
        ><img
          class="w-7"
          src="/assets/icons/icons/search.svg"
          alt=""
        /><span class="text-xs">Search</span></a
      >
      <a class="tablet-nav-item" *ngIf="user.id" [routerLink]="['/community/', user.id]"
        ><img
          class="w-7"
          src="/assets/icons/icons/community.svg"
          alt=""
        /><span class="text-xs ">Community</span></a
      >
      <a class="tablet-nav-item" *ngIf="user.id" [routerLink]="['/messages/', user.id]"
      ><img
        class="w-7"
        src="/assets/icons/icons/msg.png"
        alt=""
      /><span class="text-xs ">Messages</span></a
    >
      <a class="tablet-nav-item" *ngIf="user.id" [routerLink]="['/settings/', user.id]"
        ><img
          class="w-7"
          src="/assets/icons/icons/settings-active.svg"
          alt=""
        /><span class="text-xs text-figma-nav-green">My Profile</span></a
      >
    </nav>

      <!-- desktop-nav -->
      <nav class="bg-white hidden lg:block w-1/4 fixed h-screen overflow-y-auto px-3">

        <img class="my-4" src="assets/images/emoticloud.png" alt="" />
        <div *ngIf="user"  class="flex items-center gap-3 justify-center  mt-3">
          <img class="hidden xl:block xl:h-10 xl:w-10 rounded-full object-cover" [src]="user.profile_image" alt="Profile_Image"/>

            <div>
            <h1 class="text-lg font-medium"> {{ user.prenom }} {{ user.nom }}</h1>
            <p class="text-md font-medium text-[#61646B]"> {{ user.email }}</p>
           
        </div>
          </div>
          <div *ngIf="errorMessage">
            <p class="error">{{ errorMessage }}</p>
          </div>
        <ul class="w-fit flex flex-col mx-auto mt-8">
          <li class="nav-li">
            <img
              src="/assets/icons/icons/dashboard.svg"
              alt="Dashboard Icon"
              class="icon"
            />
            <a  *ngIf="user.id" [routerLink]="['/dashboard/', user.id]">Dashboard</a>
          </li>
          <li class="nav-li">
            <img
              src="/assets/icons/icons/search.svg"
              alt="Programs Icon"
              class="icon"
            />
            <a class="" *ngIf="user.id" [routerLink]="['/programsuggestion/', user.id]">Articles</a>
          </li>
          <li class="nav-li">
            <img
              src="/assets/icons/icons/programs.svg"
              alt="Programs Icon"
              class="icon"
            />
            <a *ngIf="user.id" [routerLink]="['/programs/', user.id]">Search</a>
          </li>
          <li class="nav-li">
            <img
              src="/assets/icons/icons/community.svg"
              alt="Community Icon"
              class="icon"
            />
            <a *ngIf="user.id" [routerLink]="['/community/', user.id]"
              >Community</a
            >
          </li>
          <li class="nav-li">
            <img
            src="/assets/icons/icons/msg.png"
              alt="Articles Icon"
              class="icon"
            />
            <a *ngIf="user.id" [routerLink]="['/messages/', user.id]">Messages</a>
          </li>
          <li class="nav-li">
            <img
              src="/assets/icons/icons/settings-active.svg"
              alt="Settings Icon"
              class="icon"
            />
            <a class="text-figma-nav-green underline-custom" *ngIf="user.id" [routerLink]="['/settings/', user.id]">My profile</a>
          </li>
          <li class="nav-li mt-3 cursor-pointer">
            <img
              src="/assets/icons/icons/logout.svg"
              alt="Settings Icon"
              class="icon "
            />
            <a (click)="onLogout()" >Logout</a>
          </li>
        </ul>
      </nav>


      <main class="flex-1 flex flex-col overflow-y-auto bg-[#ccf0ec] pb-[calc(6rem)] min-[500px]:pb-[80px] min-[1024px]:pb-[0px] lg:ml-[25%]">

        <img src="\assets\images\profile_header.png" alt="" class=" lg:-mt-12 bg-fixed sm:-mt-8 ">
      
        <a (click)="onLogout()" class="h-[30px] w-[30px] z-10 min-[1000px]:hidden fixed top-4 right-4">
          <img src="/assets/icons/icons/logout-mobile.svg" alt="" (click)="onLogout()">
        </a>
      
        <div class="p-8 ">
          
          <!-- Vue des informations utilisateur -->
          <div
          class="flex lg:justify-between gap-10 justify-start  items-center sm:-mt-32 md:-mt-36 -mt-20"
        >
          <!-- Profil uniquement pour écrans < 770px -->
          <div class="md:hidden relative">
            <img
              [src]="user.profile_image || '/assets/images/placeholder.png'"
              alt="Photo de profil"
              class="w-14 h-14 rounded-full cursor-pointer"
              (click)="toggleDropdown()"
            />
        
            <!-- Dropdown avec les informations utilisateur -->
            <div
              *ngIf="dropdownOpen"
              class="absolute top-16  bg-white shadow-lg rounded-lg p-4 z-10"
            >
              <div class="text-center">
                <img
                  [src]="user.profile_image || '/assets/images/placeholder.png'"
                  alt="Photo de profil"
                  class="w-14 h-14 mx-auto rounded-full mb-2"
                />
                <div class="text-gray-800">
                  <strong>{{ user.nom }} {{ user.prenom }}</strong>
                  <p class="text-gray-600"><strong>{{ user.email }}</strong></p>
                </div>
                <button
                  (click)="toggleEditMode()"
                  class="bg-figma-light-green text-figma-blue px-4 py-2 rounded mt-4"
                >
                  Edit
                </button>
              </div>
            </div>
          </div>
        
          <!-- Profil normal pour écrans ≥ 770px -->
          <div
            *ngIf="!editMode"
            class="hidden md:flex items-center gap-4 md:justify-between"
          >
            <div class="flex items-center gap-4">
              <img
                [src]="user.profile_image || '/assets/images/placeholder.png'"
                alt="Photo de profil"
                class="w-14 h-14 rounded-full"
              />
              <div class="text-white">
                <strong>{{ user.nom }} {{ user.prenom }}</strong>
                <p class="text-white/80"><strong>{{ user.email }}</strong></p>
              </div>
            </div>
            <button
              (click)="toggleEditMode()"
              class="bg-figma-light-green text-figma-blue px-4 py-2 rounded"
            >
              Edit
            </button>
          </div>
        </div>
        
      
          <!-- Formulaire d'édition -->
          <div *ngIf="editMode" class="fixed top-0 left-0 w-full h-full bg-gray-500 bg-opacity-50 flex items-center z-20 justify-center">
            <div class="bg-white rounded-lg p-6 w-full sm:w-1/2 lg:w-1/3">
              <div class="flex items-center gap-4">
                <img
                  [src]="user.profile_image || '/assets/images/placeholder.png'"
                  alt="Photo de profil"
                  class="w-20 h-20 rounded-full"
                />
                <input
                  type="file"
                  (change)="onFileSelected($event)"
                  class="mt-2 text-sm"
                />
              </div>
      
              <div class="mt-4">
                <label class="block">Last Name :</label>
                <input
                  [(ngModel)]="user.nom"
                  class="border px-2 py-1 w-full border-figma-blue rounded-lg"
                />
      
                <label class="block mt-2">Name :</label>
                <input
                  [(ngModel)]="user.prenom"
                  class="border px-2 py-1 w-full border-figma-blue rounded-lg"
                />
      
                <label class="block mt-2">Email :</label>
                <input
                  [(ngModel)]="user.email"
                  type="email"
                  class="border px-2 py-1 w-full border-figma-blue rounded-lg"
                />
              </div>
      
              <button
                (click)="updateUser()"
                class="bg-figma-nav-green text-white px-4 py-2 rounded mt-4"
              >
                Save
              </button>
              <button
                (click)="toggleEditMode()"
                class="bg-figma-blue/70 text-white px-4 py-2 rounded mt-4 ml-2"
              >
                Cancel
              </button>
            </div>
          </div>
      
          <!-- Statistiques utilisateur -->
          <div class="flex justify-between lg:mt-12 mt-8 items-center mb-4 flex-wrap text-sm">
            <p class="font-bold text-figma-blue px-4">Your posts : {{ postCount }}</p>
            <div class="flex gap-8 items-center">
              <p class="font-bold text-figma-blue">
                Your friends : {{ friendCount }}
              </p>
              <button (click)="toggleFriendPopup()" class="py-2 px-4 text-figma-light-green bg-figma-blue rounded-lg font-semibold">
                Show Friends 
              </button>
            </div>
          </div>
      
          <!-- Your posts -->
          <div class="sm:flex justify-between  flex-wrap">
            <div *ngIf="user" class="space-y-2 w-full  lg:w-[49%] overflow-y-auto max-h-80 scrollbar-thin px-4 rounded-lg scrollbar-thumb-figma-blue scrollbar-track-gray-200/0 scrollbar-corner-transparent">
              <div class="flex justify-start items-center gap-2">
                <img [src]="user.profile_image" alt="Profile Image" class="profile-image w-8 rounded-full">
                <p>{{ user.prenom }} {{ user.nom }}</p>
              </div>
      
              <div *ngFor="let post of user.posts">
                <span class="text-gray-500 text-xs">{{ getTimeSince(post.updated_at) }}</span>
                <div class="post-content p-4 bg-white rounded-lg shadow-lg">
                  <p>{{ post.content }}</p>
                  <div *ngIf="post.image" class="post-image">
                    <img [src]="post.image" alt="Post Image">
                  </div>
                </div>
      
                <div class="lg:flex justify-between p-2 items-center ">
                  <div class="post-actions space-x-2 flex justify-center gap-2 items-center">
                    <button (click)="addReaction(post.id, 'happy')" class="flex justify-center items-center gap-1">
                      {{ countReactions(post, 'happy') }} 
                      <div class="reaction bg-[#F4F3AC] hover:scale-150">
                        <img src="/assets/images/happy.png" alt="" class="flex justify-center items-center gap-1 hover:scale-150"> 
                      </div>
                    </button>
                    <button (click)="addReaction(post.id, 'sad')" class="flex justify-center items-center gap-1">
                      {{ countReactions(post, 'sad') }}
                      <div class="reaction bg-[#6590ff] hover:scale-150">
                        <img src="/assets/images/sad.png" alt="" class="flex justify-center items-center gap-1 hover:scale-150">
                      </div>
                    </button>
                    <button (click)="addReaction(post.id, 'angry')" class="flex justify-center items-center gap-1">
                      {{ countReactions(post, 'angry') }}
                      <div class="reaction bg-[#ff8981] hover:scale-150">
                        <img src="/assets/images/angry.png" alt="" class="hover:scale-200">
                      </div> 
                    </button>
                    <button (click)="addReaction(post.id, 'shy')" class="flex justify-center items-center gap-1">
                      {{ countReactions(post, 'shy') }}
                      <div class="reaction bg-[#F2E9EC] hover:scale-150">
                        <img src="/assets/images/shy.png" alt="" class="hover:scale-150">
                      </div> 
                    </button>
                  </div>
      
                  <div class="comments-count text-center">
                    <button (click)="openCommentsModal(post)" class="hover:underline">
                      {{ countComments(post) }} Comments
                    </button>
                  </div>
                </div>
              </div>
            </div>
      
            <div class="w-full md:w-[40%] mt-6 mx-auto">
              <img src="/assets/images/sad_joy.png" alt="">
            </div>
          </div>
      
          <!-- Modal pour afficher les commentaires -->
          <div *ngIf="selectedPostId" class="modal fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
            <div class="modal-content bg-white rounded-lg p-4 w-full sm:w-96 space-y-4 h-96 overflow-hidden">
              <div class="flex justify-between items-center">
                <h3 class="text-lg font-semibold">comments</h3>
                <button (click)="closeCommentsModal()" class="text-red-700 hover:scale-150 font-bold text-3xl">x</button>
              </div>
      
              <!-- Liste des commentaires -->
              <div class="comments space-y-2 overflow-y-auto max-h-64 scrollbar-thin scrollbar-thumb-figma-nav-green scrollbar-track-gray-200/0">
                <div *ngFor="let comment of getCommentsForPost(selectedPostId)" class="p-2">
                  <div class="flex justify-start gap-2 items-center">
                    <img [src]="comment.profile" alt="" class="rounded-full w-6">
                    <p class="font-semibold">{{ comment.author }}:</p>
                    <span class="text-gray-500 text-xs">{{ getTimeSince(comment.updated_at) }}</span>
                  </div>
                  <p class="ml-8"> {{ comment.content }}</p>
                </div>
              </div>
      
              <!-- Formulaire pour ajouter un commentaire -->
              <div class="flex justify-between items-center gap-2">
                <input
                  type="text"
                  [(ngModel)]="commentContents[selectedPostId]"
                  placeholder="Add a comment"
                  class="w-full border rounded px-2 py-1"
                />
                <button
                  (click)="addComment(selectedPostId, commentContents[selectedPostId])"
                  class="bg-figma-nav-green text-white px-4 py-1 rounded"
                >
                  Add
                </button>
              </div>
            </div>
          </div>
      
          <!-- Pop-up des amis -->
          <div *ngIf="showFriendPopup" class="fixed top-0 left-0 w-full h-full bg-gray-500 bg-opacity-50 flex items-center justify-center">
            <div class="bg-white rounded-lg p-6 w-full sm:w-1/3">
              <div class="overflow-y-auto max-h-96 scrollbar-thin scrollbar-thumb-figma-blue scrollbar-track-gray-200/0 scrollbar-corner-transparent">
                <h3 class="text-xl font-semibold mb-4">Your friend's list</h3>
                <ul>
                  <li *ngFor="let friend of friendList" class="flex justify-between items-center mb-2">
                    <div class="flex gap-2 hover:bg-figma-light-green" (click)="goToFriendProfile(user.id,friend.id)">
                      <img [src]="friend.profile_image" class="w-6 rounded-full" alt="">
                      <p>{{ friend.nom }} {{ friend.prenom }}</p> 
                    </div>
                    <button
                      (click)="removeFriend(friend.id)"
                      class="bg-[#ff8981] text-white px-3 py-1 rounded flex gap-2 items-center"
                    >
                      <div class="hover:scale-150">
                        <img src="/assets/images/angry.png" alt="" class="hover:scale-200 w-8 -mt-2">
                      </div> 
                      Unfollow
                    </button>
                  </li>
                </ul>
              </div>
              <button
                (click)="toggleFriendPopup()"
                class="mt-4 bg-gray-300 px-4 py-2 rounded"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      </main>
      
    </div>
  </body>

